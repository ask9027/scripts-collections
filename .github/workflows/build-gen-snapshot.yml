name: Build gen_snapshot ARM64 (Debian)

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-22.04

    steps:
    - name: Install base dependencies
      run: |
        sudo apt update
        sudo apt install -y git curl python3 unzip pkg-config \
          clang ninja-build build-essential \
          gcc-aarch64-linux-gnu g++-aarch64-linux-gnu \
          libc6-dev-arm64-cross

    - name: Clone Flutter Engine (latest)
      run: |
        git clone https://github.com/flutter/engine.git --depth=1
        cd engine
        git submodule update --init --recursive

    - name: Run gclient sync (needed for DEPS)
      run: |
        cd engine
        ./flutter/tools/gn --target-cpu=arm64 --runtime-mode=release

    - name: Build gen_snapshot (ARM64)
      run: |
        cd engine/src
        ninja -C out/linux_arm64_release gen_snapshot

    - name: Upload gen_snapshot Artifact
      uses: actions/upload-artifact@v4
      with:
        name: gen_snapshot-arm64
        path: engine/out/linux_arm64_release/gen_snapshot
